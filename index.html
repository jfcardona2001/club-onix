<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Club Ónix - Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial,sans-serif;margin:20px;}
input,button{padding:5px;margin:5px 0;}
h2{margin-top:20px;}
#error{color:red;}
#panel{display:none;}
</style>
</head>
<body>

<h1>Club Deportivo Volleyball Ónix</h1>

<!-- LOGIN -->
<div id="loginDiv">
  <h2>Ingreso al sistema</h2>
  <input type="email" id="loginEmail" placeholder="Correo electrónico" required><br>
  <input type="password" id="loginPassword" placeholder="Contraseña" required><br>
  <button onclick="login()">Ingresar</button>
  <p id="error"></p>
</div>

<!-- PANEL -->
<div id="panel">
  <h2>Panel Administrador</h2>
  <button onclick="logout()">Cerrar sesión</button>

  <h3>Registrar deportista</h3>
  <input id="nombre" placeholder="Nombre completo">
  <input id="categoria" placeholder="Categoría">
  <input id="acudiente" placeholder="Nombre del acudiente">
  <input id="telefono" placeholder="Teléfono">
  <input id="correoAcudiente" placeholder="Correo electrónico acudiente">
  <button onclick="agregarDeportista()">Agregar</button>

  <h3>Lista de deportistas</h3>
  <ul id="lista"></ul>
</div>

<script type="module">
  // ===== FIREBASE =====
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDIFkhozwB5W7NYdjJlvH-EZvPlvFsOz3E",
    authDomain: "club-deportivo-de-volley-onix.firebaseapp.com",
    projectId: "club-deportivo-de-volley-onix",
    storageBucket: "club-deportivo-de-volley-onix.firebasestorage.app",
    messagingSenderId: "378193996380",
    appId: "1:378193996380:web:12c4c1cf27499e224a9499",
    measurementId: "G-Y8DL77DH3J"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // ===== LOGIN =====
  async function login(){
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    const error = document.getElementById("error");

    try{
      await signInWithEmailAndPassword(auth,email,password);
      error.innerText="";
    }catch(e){
      error.innerText="Correo o contraseña incorrectos";
    }
  }

  function logout(){
    signOut(auth);
  }

  // ===== CONTROL DE SESIÓN =====
  onAuthStateChanged(auth,user=>{
    if(user){
      document.getElementById("loginDiv").style.display="none";
      document.getElementById("panel").style.display="block";
      mostrarDeportistas();
    }else{
      document.getElementById("loginDiv").style.display="block";
      document.getElementById("panel").style.display="none";
    }
  });

  // ===== DEPORTISTAS =====
  const deportistasCol = collection(db,"deportistas");

  async function agregarDeportista(){
    const nombre = document.getElementById("nombre").value;
    const categoria = document.getElementById("categoria").value;
    const acudiente = document.getElementById("acudiente").value;
    const telefono = document.getElementById("telefono").value;
    const correoAcudiente = document.getElementById("correoAcudiente").value;
    if(!nombre) return;
    await addDoc(deportistasCol,{
      nombre,categoria,acudiente,telefono,correoAcudiente
    });
    mostrarDeportistas();
    document.getElementById("nombre").value="";
    document.getElementById("categoria").value="";
    document.getElementById("acudiente").value="";
    document.getElementById("telefono").value="";
    document.getElementById("correoAcudiente").value="";
  }

  async function mostrarDeportistas(){
    const lista = document.getElementById("lista");
    lista.innerHTML="";
    const snapshot = await getDocs(deportistasCol);
    snapshot.forEach(docSnap=>{
      const d = docSnap.data();
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${d.nombre}</strong> - ${d.categoria}<br>
        Acudiente: ${d.acudiente} | Tel: ${d.telefono} | Correo: ${d.correoAcudiente}
        <button onclick="editar('${docSnap.id}')">Editar</button>
        <button onclick="borrar('${docSnap.id}')">Borrar</button>
      `;
      lista.appendChild(li);
    });
  }

  async function borrar(id){
    await deleteDoc(doc(db,"deportistas",id));
    mostrarDeportistas();
  }

  async function editar(id){
    const docSnap = await getDocs(deportistasCol);
    const ref = doc(db,"deportistas",id);
    const nombre = prompt("Nuevo nombre:");
    const categoria = prompt("Nueva categoría:");
    const acudiente = prompt("Nuevo acudiente:");
    const telefono = prompt("Nuevo teléfono:");
    const correoAcudiente = prompt("Nuevo correo:");
    await updateDoc(ref,{
      nombre,nombre,nombre,nombre,
      categoria,acudiente,telefono,correoAcudiente
    });
    mostrarDeportistas();
  }

</script>

</body>
</html>
