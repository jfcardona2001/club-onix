<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Club Ónix - Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial,sans-serif;margin:20px;}
input,button{padding:5px;margin:5px 0;}
h2{margin-top:20px;}
#error{color:red;}
#panel{display:none;}
ul{list-style:none;padding-left:0;}
li{margin-bottom:10px;}
button{margin-left:5px;}
</style>

<!-- FIREBASE COMPAT (funciona en GitHub Pages sin módulos) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

<h1>Club Deportivo Volleyball Ónix</h1>

<!-- LOGIN -->
<div id="loginDiv">
  <h2>Ingreso al sistema</h2>
  <input type="email" id="loginEmail" placeholder="Correo electrónico" required><br>
  <input type="password" id="loginPassword" placeholder="Contraseña" required><br>
  <button onclick="login()">Ingresar</button>
  <p id="error"></p>
</div>

<!-- PANEL -->
<div id="panel">
  <h2>Panel Administrador</h2>
  <button onclick="logout()">Cerrar sesión</button>

  <h3>Registrar deportista</h3>
  <input id="nombre" placeholder="Nombre completo">
  <input id="categoria" placeholder="Categoría">
  <input id="acudiente" placeholder="Nombre del acudiente">
  <input id="telefono" placeholder="Teléfono">
  <input id="correoAcudiente" placeholder="Correo electrónico acudiente">
  <button onclick="agregarDeportista()">Agregar</button>

  <h3>Lista de deportistas</h3>
  <ul id="lista"></ul>
</div>

<script>
  // ===== FIREBASE CONFIG =====
  const firebaseConfig = {
    apiKey: "AIzaSyDIFkhozwB5W7NYdjJlvH-EZvPlvFsOz3E",
    authDomain: "club-deportivo-de-volley-onix.firebaseapp.com",
    projectId: "club-deportivo-de-volley-onix",
    storageBucket: "club-deportivo-de-volley-onix.firebasestorage.app",
    messagingSenderId: "378193996380",
    appId: "1:378193996380:web:12c4c1cf27499e224a9499",
    measurementId: "G-Y8DL77DH3J"
  };

  // Inicializar Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ===== LOGIN =====
  function login(){
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    const error = document.getElementById("error");

    auth.signInWithEmailAndPassword(email,password)
      .then(() => {
        error.innerText="";
      })
      .catch(() => {
        error.innerText="Correo o contraseña incorrectos";
      });
  }

  function logout(){
    auth.signOut();
  }

  // ===== CONTROL DE SESIÓN =====
  auth.onAuthStateChanged(user => {
    if(user){
      document.getElementById("loginDiv").style.display="none";
      document.getElementById("panel").style.display="block";
      mostrarDeportistas();
    } else {
      document.getElementById("loginDiv").style.display="block";
      document.getElementById("panel").style.display="none";
    }
  });

  // ===== DEPORTISTAS =====
  function limpiarInputs(){
    document.getElementById("nombre").value="";
    document.getElementById("categoria").value="";
    document.getElementById("acudiente").value="";
    document.getElementById("telefono").value="";
    document.getElementById("correoAcudiente").value="";
  }

  function agregarDeportista(){
    const nombre = document.getElementById("nombre").value;
    const categoria = document.getElementById("categoria").value;
    const acudiente = document.getElementById("acudiente").value;
    const telefono = document.getElementById("telefono").value;
    const correoAcudiente = document.getElementById("correoAcudiente").value;

    if(!nombre) return;

    db.collection("deportistas").add({
      nombre, categoria, acudiente, telefono, correoAcudiente
    }).then(() => {
      limpiarInputs();
      mostrarDeportistas();
    });
  }

  function mostrarDeportistas(){
    const lista = document.getElementById("lista");
    lista.innerHTML="";

    db.collection("deportistas").get().then(snapshot => {
      snapshot.forEach(docSnap => {
        const d = docSnap.data();
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${d.nombre}</strong> - ${d.categoria}<br>
          Acudiente: ${d.acudiente} | Tel: ${d.telefono} | Correo: ${d.correoAcudiente}
          <button onclick="editar('${docSnap.id}')">Editar</button>
          <button onclick="borrar('${docSnap.id}')">Borrar</button>
        `;
        lista.appendChild(li);
      });
    });
  }

  function borrar(id){
    db.collection("deportistas").doc(id).delete().then(() => {
      mostrarDeportistas();
    });
  }

  function editar(id){
    const nombre = prompt("Nuevo nombre:");
    const categoria = prompt("Nueva categoría:");
    const acudiente = prompt("Nuevo acudiente:");
    const telefono = prompt("Nuevo teléfono:");
    const correoAcudiente = prompt("Nuevo correo:");

    if(!nombre) return;

    db.collection("deportistas").doc(id).update({
      nombre, categoria, acudiente, telefono, correoAcudiente
    }).then(() => {
      mostrarDeportistas();
    });
  }
</script>

</body>
</html>
